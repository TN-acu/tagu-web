<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>taguアプリ</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --app-height: 100vh;
            --footer-height: 50px; /* フッターコントロールバーの高さ */
            /* Light Mode Colors */
            --bg-color-light: #f8f9fa;
            --text-color-light: #212529;
            --border-color-light: #dee2e6;
            --link-color-light: #007bff;
            --hover-bg-color-light: #e9ecef;
            --secondary-bg-light: #ffffff;
            /* Dark Mode Colors */
            --bg-color-dark: #212529;
            --text-color-dark: #f8f9fa;
            --border-color-dark: #495057;
            --link-color-dark: #66bfff;
            --hover-bg-color-dark: #343a40;
            --secondary-bg-dark: #343a40;
        }
        html {
            height: 100%;
        }
        body {
            margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden; 
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            transition: background-color 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            height: var(--app-height); 
        }
        body.dark-mode {
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
        }

        .container { 
            display: flex; 
            flex-grow: 1; 
            overflow: hidden; 
            min-height: 0; 
        }
        .nav-column {
            flex-shrink: 0; 
            width: 250px; 
            background-color: var(--bg-color-light); 
            padding: 15px;
            border-right: 2px solid var(--border-color-light); 
            overflow-y: auto;
            box-sizing: border-box;
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.dark-mode .nav-column {
            background-color: var(--bg-color-dark);
            border-right-color: var(--border-color-dark);
        }

        .content-column { 
            flex-grow: 1; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }
        iframe { 
            width: 100%; 
            flex-grow: 1; 
            border: none; 
        }
        .nav-column h2 { 
            margin-top: 0; 
            font-size: 1.3em; 
        }
        .nav-column ul { 
            list-style: none; 
            padding: 0; 
            margin: 0;
            transition: all 0.3s ease-out; 
            overflow: hidden; 
        }
        .nav-column li { margin-bottom: 8px; }
        .nav-column a { 
            text-decoration: none; 
            color: var(--link-color-light); 
            font-size: 1.1em; 
            display: block; padding: 6px 10px; border-radius: 5px; 
            transition: background-color 0.2s, color 0.2s; 
        }
        body.dark-mode .nav-column a {
            color: var(--link-color-dark);
        }
        .nav-column a:hover { 
            background-color: var(--hover-bg-color-light); 
        }
        body.dark-mode .nav-column a:hover {
             background-color: var(--hover-bg-color-dark);
        }
        
        .update-info {
            font-size: 0.5em;
            color: #999;
            font-weight: normal;
            vertical-align: middle;
            margin-left: 10px;
        }

        #footer-controls {
            flex-shrink: 0; 
            height: var(--footer-height);
            background-color: var(--secondary-bg-light);
            border-top: 1px solid var(--border-color-light);
            padding: 5px 10px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            z-index: 100;
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.dark-mode #footer-controls {
            background-color: var(--secondary-bg-dark);
            border-top-color: var(--border-color-dark);
        }

        .dark-mode-toggle {
            flex-shrink: 0;
            padding: 8px;
            margin-right: 10px;
            cursor: pointer;
            border-radius: 5px;
            border: 1px solid var(--border-color-light);
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            font-size: 0.9em;
        }
        body.dark-mode .dark-mode-toggle {
            border-color: var(--border-color-dark);
            color: var(--text-color-dark);
            background-color: var(--bg-color-dark);
        }

        .search-container {
            display: flex;
            width: 100%;
            flex-grow: 1; 
        }
        .search-container input[type="search"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--border-color-light);
            border-radius: 5px 0 0 5px;
            font-size: 0.9em;
            background-color: var(--secondary-bg-light);
            color: var(--text-color-light);
            min-width: 50px; 
        }
        body.dark-mode .search-container input[type="search"] {
            border-color: var(--border-color-dark);
            background-color: var(--secondary-bg-dark);
            color: var(--text-color-dark);
        }
        .search-container button {
            flex-shrink: 0;
            width: 36px;
            padding: 0;
            border: 1px solid var(--border-color-light);
            background-color: var(--bg-color-light);
            color: var(--text-color-light);
            cursor: pointer;
            font-size: 1.1em;
            line-height: 1;
        }
        .search-container button:first-of-type {
            border-left: none;
        }
         .search-container button:last-of-type {
            border-left: none;
            border-radius: 0 5px 5px 0;
        }
        body.dark-mode .search-container button {
            border-color: var(--border-color-dark);
            background-color: var(--bg-color-dark);
            color: var(--text-color-dark);
        }

        @media (max-width: 768px) {
            .container { 
                flex-direction: column; 
            }
            .nav-column { 
                width: 100%; 
                border-right: none; 
                padding: 0; 
                flex-basis: auto; 
                flex-shrink: 0; 
                overflow-y: hidden; 
                transition: height 0.3s ease-out; 
            }
            body.dark-mode .nav-column {
                background-color: var(--bg-color-dark);
            }
            .nav-column h2 { display: none; }
            .menu-toggle { display: flex; }
            #menu-toggle-open { border-bottom: 2px solid var(--border-color-light); }
            body.dark-mode #menu-toggle-open { border-bottom-color: var(--border-color-dark); }
            #menu-toggle-close { display: none; }
            .nav-column ul { height: 0; padding: 0 15px; flex-direction: column; }
            .nav-column.menu-open ul {
                height: auto; 
                display: flex; 
                padding: 10px 15px; 
                border-bottom: 2px solid var(--border-color-light); 
            }
            body.dark-mode .nav-column.menu-open ul { border-bottom-color: var(--border-color-dark); }
            .nav-column li { margin-bottom: 5px; text-align: center; }
            .nav-column a { margin: 0; font-size: 1.1em; padding: 8px 10px; }
            .content-column { flex-grow: 1; min-height: 0; }
        }
        
        .menu-toggle {
            width: 100%; padding: 10px; font-size: 1.2em; font-weight: bold;
            text-align: center; background-color: #28a745; color: white; 
            border: none; cursor: pointer; box-sizing: border-box;
            transition: all 0.3s ease-out; display: flex; align-items: center; justify-content: center;
        }
        .menu-toggle.close-btn { border-top: 2px solid var(--border-color-light); margin-top: 10px; }
        body.dark-mode .menu-toggle.close-btn { border-top-color: var(--border-color-dark); }
        .menu-toggle .arrow {
            display: inline-block; margin-left: 8px; width: 0; height: 0;
            border-left: 6px solid transparent; border-right: 6px solid transparent;
            vertical-align: middle; transition: transform 0.3s ease-out;
        }
        .menu-toggle.open-btn .arrow { border-top: 6px solid white; }
        .menu-toggle.close-btn .arrow { border-bottom: 6px solid white; }
    </style>
</head>
<body>

    <div class="container">
        <div class="nav-column" id="nav-column">
            <h2 id="pc-menu-title">アプリ選択<span id="last-updated" class="update-info"></span></h2>
            <button class="menu-toggle open-btn" id="menu-toggle-open">
                他のアプリを選択する <span class="arrow"></span>
            </button>
            <ul id="app-list">
                <li><a href="timer-portrait.html" target="contentFrame">●実技用タイマー(縦表示)</a></li>
                <li><a href="timer-landscape.html" target="contentFrame">●実技用タイマー(横表示)</a></li>
                <li><a href="quiz-kaibougaku/quiz-kaibougaku.html" target="contentFrame">●解剖学2025前期期末クイズ(Forms全316問+過去問170問以上)</a></li>
                <li><a href="quiz-iryougairon2025zenki/quiz-iryougairon2025zenki-kimatu.html" target="contentFrame">●医療概論2025前期期末クイズ(過去問55問+国試問題13問)</a></li>
                <li><a href="quiz-iryoutoshakai2025zenki/quiz-iryoutoshakai2025zenki-kimatu.html" target="contentFrame">●医療と社会2025前期期末クイズ(予想27問+過去問21問)</a></li>
                <li><a href="quiz-sizenkagaku2025zenki/quiz-sizenkagaku2025zenki-kimatu.html" target="contentFrame">●自然科学2025前期期末クイズ(過去問40問)</a></li>
                <li><a href="quiz-seirigaku2025zenki-kimatu/quiz-seirigaku2025zenki-kimatu.html" target="contentFrame">●生理学2025前期期末クイズ(生理学復習問題①PDFから38問(38～72、74、76～77)+過去問74問 ※不適切問題1問以外)</a></li>
                <li><a href="quiz-touyouigakugairon2025zenki-kimatu/quiz-touyouigakugairon2025zenki-kimatu.html" target="contentFrame">●東洋医学概論2025前期期末クイズ(Forms試験範囲復習60問＋Forms練習問題70問)</a></li>
                <li> 
                    <button class="menu-toggle close-btn" id="menu-toggle-close">
                        他のアプリ選択メニューを閉じる <span class="arrow"></span>
                    </button>
                </li>
            </ul>
        </div>
        <div class="content-column">
            <iframe src="timer-portrait.html" name="contentFrame" id="contentFrame" title="コンテンツ表示エリア">
                お使いのブラウザはiframeに対応していません。
            </iframe>
        </div>
    </div>

    <div id="footer-controls">
        <button id="dark-mode-toggle" class="dark-mode-toggle" title="ダークモード切替">🌙</button>
        <div class="search-container">
            <input type="search" id="search-input" placeholder="表示画面内を検索...">
            <button id="search-prev" title="前を検索">△</button>
            <button id="search-next" title="次を検索">▽</button>
        </div>
    </div>

    <script>
        const iframe = document.getElementById('contentFrame');
        const bodyElement = document.body;

        const setAppHeight = () => {
            document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`);
        };
        window.addEventListener('resize', setAppHeight);
        window.addEventListener('orientationchange', setAppHeight);
        setAppHeight();

        const displayLastUpdated = () => {
            const lastModified = new Date(document.lastModified);
            const year = lastModified.getFullYear();
            const month = String(lastModified.getMonth() + 1).padStart(2, '0');
            const day = String(lastModified.getDate()).padStart(2, '0');
            const hours = String(lastModified.getHours()).padStart(2, '0');
            const minutes = String(lastModified.getMinutes()).padStart(2, '0');
            const seconds = String(lastModified.getSeconds()).padStart(2, '0');
            const formattedDate = `${year}${month}${day} ${hours}:${minutes}:${seconds}`;
            const updateElement = document.getElementById('last-updated');
            if (updateElement) {
                updateElement.innerHTML = `last update ${formattedDate}`;
            }
        };
        displayLastUpdated();

        const menuToggleOpenBtn = document.getElementById('menu-toggle-open');
        const menuToggleCloseBtn = document.getElementById('menu-toggle-close');
        const navColumn = document.getElementById('nav-column');
        const appList = document.getElementById('app-list');
        const pcMenuTitle = document.getElementById('pc-menu-title');

        const setupMobileMenuLayout = () => {
            if (window.innerWidth <= 768) {
                pcMenuTitle.style.display = 'none';
                menuToggleOpenBtn.style.display = 'flex';
                menuToggleCloseBtn.style.display = 'none';
                navColumn.classList.remove('menu-open'); 
                appList.style.height = '0';
                appList.style.paddingTop = '0';
                appList.style.paddingBottom = '0';
            } else {
                pcMenuTitle.style.display = 'block';
                menuToggleOpenBtn.style.display = 'none';
                menuToggleCloseBtn.style.display = 'none';
                navColumn.classList.remove('menu-open');
                appList.style.height = 'auto'; 
            }
        };

        const toggleMenu = () => {
            if (window.innerWidth > 768) return;
            navColumn.classList.toggle('menu-open');
            const isOpen = navColumn.classList.contains('menu-open');
            if (isOpen) {
                menuToggleOpenBtn.style.display = 'none';
                menuToggleCloseBtn.style.display = 'flex';
                appList.style.height = 'auto';
                const scrollHeight = appList.scrollHeight;
                appList.style.height = '0';
                setTimeout(() => { appList.style.height = `${scrollHeight}px`; appList.style.paddingTop = '10px'; appList.style.paddingBottom = '10px'; }, 10);
            } else {
                menuToggleOpenBtn.style.display = 'flex';
                menuToggleCloseBtn.style.display = 'none';
                appList.style.height = `${appList.scrollHeight}px`;
                setTimeout(() => { appList.style.height = '0'; appList.style.paddingTop = '0'; appList.style.paddingBottom = '0'; }, 10);
            }
            setTimeout(setAppHeight, 300); 
        };

        menuToggleOpenBtn.addEventListener('click', toggleMenu);
        menuToggleCloseBtn.addEventListener('click', toggleMenu);
        const appLinks = document.querySelectorAll('#app-list a');
        appLinks.forEach(link => {
            link.addEventListener('click', () => { if (navColumn.classList.contains('menu-open')) { toggleMenu(); } });
        });
        window.addEventListener('resize', setupMobileMenuLayout);
        setupMobileMenuLayout(); 

        const darkModeButton = document.getElementById('dark-mode-toggle');
        const applyDarkModeToIframe = (enable) => {
            try {
                const iframeDoc = iframe.contentDocument;
                if (!iframeDoc) return; 
                const styleElementId = 'injected-dark-mode-style';
                let styleElement = iframeDoc.getElementById(styleElementId);
                if (enable) {
                    if (!styleElement) {
                        styleElement = iframeDoc.createElement('style');
                        styleElement.id = styleElementId;
                        iframeDoc.head.appendChild(styleElement);
                    }
                    styleElement.textContent = `
                        body { background-color: #212529 !important; color: #f8f9fa !important; }
                        ::selection { background-color: #ffc107 !important; color: #000000 !important; }
                        .quiz-container, .timer-container, div[style*="background"], section, main {
                            background-color: transparent !important; color: inherit !important;
                        }
                        button, input, select {
                            background-color: #343a40 !important; color: #f8f9fa !important; border-color: #495057 !important;
                        }
                        a { color: #66bfff !important; }
                    `;
                } else {
                    if (styleElement) { styleElement.remove(); }
                }
            } catch (e) {
                console.warn("Could not access iframe content for dark mode: ", e.message);
            }
        };

        darkModeButton.addEventListener('click', () => {
            bodyElement.classList.toggle('dark-mode');
            const isDarkModeEnabled = bodyElement.classList.contains('dark-mode');
            darkModeButton.textContent = isDarkModeEnabled ? '☀️' : '🌙';
            applyDarkModeToIframe(isDarkModeEnabled);
        });

        const searchInput = document.getElementById('search-input');
        const searchPrevBtn = document.getElementById('search-prev');
        const searchNextBtn = document.getElementById('search-next');

        const performSearch = (direction) => {
            const searchTerm = searchInput.value;
            if (!searchTerm) return;

            try {
                const iframeWin = iframe.contentWindow;
                const iframeDoc = iframe.contentDocument;

                // --- iOS Highlighting Fix ---
                // 1. iframeウィンドウにフォーカスを当てる。
                iframeWin.focus();

                // 2. iOS/WebKit向けの回避策: contentEditableを一時的にtrueにする。
                //    これにより、非アクティブなiframeでも選択範囲ハイライトが描画されるよう強制する。
                const originalEditableState = iframeDoc.body.isContentEditable ? "true" : "false";
                iframeDoc.body.contentEditable = "true";
                
                // 3. 検索を実行する。
                const found = iframeWin.find(searchTerm, false, direction === 'prev', true);
                
                if (!found) {
                    if (iframeWin.getSelection) {
                        iframeWin.getSelection().removeAllRanges();
                    }
                    iframeWin.find(searchTerm, false, direction === 'prev', true);
                }

                // 4. contentEditableの状態を元に戻す。
                iframeDoc.body.contentEditable = originalEditableState;
                
                // 5. 念のため再度フォーカスを当てる（ハイライト維持に役立つ場合がある）。
                iframeWin.focus();
                // --- End Fix ---

            } catch (e) {
                console.error("Error searching iframe content:", e.message);
                alert("iframe内の検索中にエラーが発生しました。");
            }
        };

        searchNextBtn.addEventListener('click', () => performSearch('next'));
        searchPrevBtn.addEventListener('click', () => performSearch('prev'));
        searchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                performSearch('next');
            }
        });
        
        iframe.addEventListener('load', () => {
            applyDarkModeToIframe(bodyElement.classList.contains('dark-mode'));
            setAppHeight();
        });
    </script>

</body>
</html>